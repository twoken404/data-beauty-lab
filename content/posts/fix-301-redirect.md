---
title: “hugo + vercel + cloudflare 308重定向问题”
date: 2026-01-11 
draft: false 
tags: ["Cloudflare", "Vercel", "HTTP重定向", "301","308","hugo","HTTPS"]
---
# google search 无法抓取，原来是因为这个重定向问题

我的网站 139010.xyz 最近在谷歌后台收到一个“重定向错误”的警告。经过一番折腾，我终于搞明白了原因并解决了它。我的网站是用 Hugo 生成的，并且托管在 Vercel 上。

## 问题出在哪？

当有人用 `http://`（不安全的链接）访问我的网站时，Vercel（我的网站托管平台）会非常严格地把他“踢”到 `https://`（安全的链接）版本去。这本身是好事，但问题在于，Vercel “踢人”时用的是一种比较新的、叫 **`308`** 的“指令”。

然而，谷歌的搜索引擎蜘蛛（或者一些其他工具）在处理这个 `308` “指令”时，好像没那么“机灵”，有时候会犯糊涂，理解不好这个永久跳转的意思，于是就给我报了个错。

我用一个命令就能看到这个问题：

```bash
curl -I http://139010.xyz
```
本来期待看到 `HTTP/1.1 301 Moved Permanently`，但实际返回的却是 `HTTP/1.1 308 Permanent Redirect`。

## 为什么不能直接在Vercel上改？

我查了Vercel的官方文档，发现这个 `308` 是他们平台的强制设定，目的是为了保证安全。无论我怎么调整网站代码或者配置文件，**都无法改变Vercel的这个默认行为**。这就像房东定下的租房规矩，房客改不了。

## 解决思路：

既然在Vercel（源头）上改不了，那么能不能在流量到达Vercel之前，先做点手脚呢？我的域名使用了 Cloudflare 的服务，它就像一个“流量中转站”和“安检门”，所有访客都要先经过它才能到我的网站。

那么，我就在 Cloudflare 这里设置一下，让它帮我完成这个“指令”的替换工作。具体做法如下：

### 第一步：打开“强制HTTPS”开关
在 Cloudflare 控制台，找到 `139010.xyz` 这个域名，进入 **SSL/TLS** 设置下的 **Edge Certificates** 菜单。这里面有一个叫 **“Always Use HTTPS”** 的开关，把它打开。

**这个开关的作用是**：只要有人试图用 `http://` 访问，Cloudflare 这个“安检门”就会立刻拦下，并主动告诉他：“请走右边的 `https://` 安全通道”，而且用的是经典的 `301` “指令”。

### 第二步：调整回源加密模式
还是在 Cloudflare 的 **SSL/TLS** 设置里，这次看 **Overview** 页面。把 **SSL/TLS encryption mode** 这一项改成 **“Full”**。

**为什么这一步很重要**：这确保了 Cloudflare 去 Vercel 那里拿网站内容的时候，走的也是安全加密通道。如果这里没设置对，可能会引起 Cloudflare 和 Vercel 之间互相“踢皮球”，导致访问出错。

## 最终效果

设置完上面两步，等一小会儿，再运行检查命令：

```bash
curl -I http://139010.xyz
```
现在，返回的结果就变成了我们想要的：
`HTTP/1.1 301 Moved Permanently`
同时，`Location: https://139010.xyz/` 这一行也清楚地指向了安全地址。

这就意味着，无论是普通用户还是谷歌的蜘蛛，现在用不安全的链接访问时，都会第一时间从 Cloudflare 那里收到一个清晰、标准的 `301` 永久重定向指令。Vercel 返回的那个 `308` 指令，已经被 Cloudflare 给“过滤”掉了，不会再对外界造成困扰。谷歌搜索引擎的警告，自然也就解决了。

## 总结

当我们使用的某个云服务（比如Vercel）有无法改变的默认规则时，可以巧妙地利用它前面的另一层服务（比如Cloudflare）来做规则转换。

对于同样使用 **Hugo + Vercel** 建站，并且遇到类似重定向问题的朋友，可以试试配置 Cloudflare 的 **“Always Use HTTPS”** 功能和 **“Full”** 加密模式组合，这应该是最直接有效的解决办法。

